<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/styles.css">
    <script src="js/script.js" type="text/javascript"></script>
    <title>Consultar o CPF</title>

</head>

<body>


    <form id="meuFormulario">
        <div class="logo-container">
            <img src="img/brasao.png" alt="Logo do Ministério" class="logo">
        </div>
        <h1>Ministério da Agricultura e Pecuária</h1>
        <h2>Governo Federal</h2>
        <h1>____________________________</h1>
        <br>
        <h2>Cadastro de Localização dos Concursados Nomeados em 2025</h2>
        <br>
        <div>
            <label for="cpf">Digite o CPF:</label>
            <input type="text" id="cpf" name="cpf" required> <br><br>
            <button type="button" onclick="consultarListaResultado()">Consultar</button>
        </div>
        <br>
        <h2>Dados Encontrados:</h2>
        <div>
            <label for="nome">Nome:</label>
            <input type="text" id="nome" name="nome" readonly>
        </div>
        <br>
        <div>
            <label for="cargo">Cargo:</label>
            <input type="text" id="cargo" name="cargo" readonly>
        </div>
        <br>
        <div>
            <label for="email">E-mail:</label>
            <input type="email" id="email" name="email" placeholder="Informe seu e-mail pessoal." required>
        </div>
        <br>
        <br>
        <div>
            <h3>Municípios de Localização:</h3>
            <label>1ª Opção:</label>
            <select id="municipio1" name="municipio1" placeholder="Selecione o município" disabled>
                <option value="">Selecione um município.</option>
            </select>
            <br>
            <br>
            <label>2ª Opção:</label>
            <select id="municipio2" name="municipio2" disabled>
                <option value="">Selecione um município.</option>
            </select>
            <br>
            <br>
            <label>3ª Opção:</label>
            <select id="municipio3" name="municipio3" disabled>
                <option value="">Selecione um município.</option>
            </select>
            <br>
            <br>
            <label>4ª Opção:</label>
            <select id="municipio4" name="municipio4" disabled>
                <option value="">Selecione um município.</option>
            </select>
            <br>
            <br>
            <label>5ª Opção:</label>
            <select id="municipio5" name="municipio5" disabled>
                <option value="">Selecione um município.</option>
            </select>
        </div>
        <br>
        <label>OBS.: Uma vez realizado o cadastro, não será permitida qualquer alteração. Dessa forma, sugerimos que
            confira todos os dados antes de salvá-los.</label>
        <br>
        <button type="button" onclick="salvarDadosParaPowerAutomate()">Salvar</button>
    </form>

    <div id="confirmModal" style="display: none;" class="modal-overlay" role="dialog" aria-modal="true">
        <div class="modal-box">
            <p>Após realizado o cadastro, não será possível qualquer alteração.</p>
            <p>Deseja confirmar a sua escolha?</p>
            <div class="modal-buttons">
                <button id="btnSim">SIM</button>
                <button id="btnNao">NÃO</button>
            </div>
        </div>
    </div>

</body>

</html>

<script>

    mascaraCPF();

    let dadosParaSalvar = null;


    async function salvarDadosParaPowerAutomate() {


        if (!verificarMunicipiosDuplicados()) return;

        // Armazenar dados antes da confirmação
        const cpf = document.getElementById('cpf').value;
        const nome = document.getElementById('nome').value;
        const cargo = document.getElementById('cargo').value;
        const email = document.getElementById('email').value.trim();
        const municipio1 = document.getElementById('municipio1').value;
        const municipio2 = document.getElementById('municipio2').value;
        const municipio3 = document.getElementById('municipio3').value;
        const municipio4 = document.getElementById('municipio4').value;
        const municipio5 = document.getElementById('municipio5').value;

        const cpfLimpo = cpf.replace(/\D/g, '').replace(/^0+/, '');

        const verificaEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

        if (!verificaEmail.test(email)) {
            alert("Por favor, digite um e-mail válido.");
            return;
        }

        if (!cpfLimpo || !nome || !cargo || !municipio1) {
            alert('Os campos CPF, Nome e Cargo devem estar preenchidos e, ao menos, a 1ª opção de município.');
            return;
        }


        dadosParaSalvar = {
            cpf: cpfLimpo,
            nome: nome,
            cargo: cargo,
            email: email,
            Municipio1: municipio1,
            Municipio2: municipio2,
            Municipio3: municipio3,
            Municipio4: municipio4,
            Municipio5: municipio5
        };

        // Mostrar modal
        document.getElementById('confirmModal').style.display = 'flex';

    }

    document.getElementById('btnSim').addEventListener('click', async function () {
        const webhookUrl = 'https://prod-01.brazilsouth.logic.azure.com:443/workflows/1fb9782709ea489f8118a7c5e6408497/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=9ZFHCbVBb6WufeVspGOCEARPhsRlTz-umpMGruWualw'; 
        document.getElementById('confirmModal').style.display = 'none';

        try {
            const response = await fetch(webhookUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(dadosParaSalvar)
            });


            if (response.ok || response.status === 0) {
                alert('Dados cadastrados com sucesso!');
                limparFormulario();
                return 1;
            } else {
                alert('Erro ao salvar.');
                limparFormulario();
            }


        } catch (error) {
            alert('Erro inesperado ao enviar os dados.');
            limparFormulario();
        }
    });

    document.getElementById('btnNao').addEventListener('click', function () {
        document.getElementById('confirmModal').style.display = 'none';
        dadosParaSalvar = null;
    });


</script>

</body>

</html>